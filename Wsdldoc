<xsl:stylesheet version="2.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
  xmlns:xs="http://www.w3.org/2001/XMLSchema">

  <xsl:output method="html"/>

  <!-- Template for the WSDL document -->
  <xsl:template match="wsdl:definitions">
    <html>
      <head>
        <title><xsl:value-of select="@name"/></title>
      </head>
      <body>
        <h1><xsl:value-of select="@name"/></h1>
        <table>
          <tr>
            <th>Service Name</th>
            <td><xsl:value-of select="wsdl:service/@name"/></td>
          </tr>
          <tr>
            <th>Endpoint URL</th>
            <td><xsl:value-of select="wsdl:service/wsdl:port/@binding"/></td>
          </tr>
        </table>
        <xsl:apply-templates select="wsdl:portType/wsdl:operation"/>
      </body>
    </html>
  </xsl:template>

  <!-- Template for each operation -->
  <xsl:template match="wsdl:operation">
    <h2><xsl:value-of select="@name"/></h2>
    <table>
      <tr>
        <th>Input</th>
        <th>Output</th>
      </tr>
      <tr>
        <td><xsl:apply-templates select="wsdl:input"/></td>
        <td><xsl:apply-templates select="wsdl:output"/></td>
      </tr>
    </table>
  </xsl:template>

  <!-- Template for input details -->
  <xsl:template match="wsdl:input">
    <table>
      <caption>Request</caption>
      <tr>
        <th>Operation Name</th>
        <td><xsl:value-of select="../@name"/></td>
      </tr>
      <tr>
        <th>Request Schema</th>
        <td><xsl:value-of select="@message"/></td>
      </tr>
      <tr>
        <th>Sample Request</th>
        <td>
          <pre><code>
            &lt;<xsl:value-of select="substring-after(@message, ':')"/> xmlns="<xsl:value-of select="../@targetNamespace"/>">
              <xsl:apply-templates select="document(concat(substring-after(@message, ':'), '.xsd'))/*"/>
            &lt;/<xsl:value-of select="substring-after(@message, ':')"/>>
          </code></pre>
        </td>
      </tr>
    </table>
  </xsl:template>

  <!-- Template for output details -->
  <xsl:template match="wsdl:output">
    <table>
      <caption>Response</caption>
      <tr>
        <th>Operation Name</th>
        <td><xsl:value-of select="../@name"/></td>
      </tr>
      <tr>
             <tr>
        <th>Response Schema</th>
        <td><xsl:value-of select="@message"/></td>
      </tr>
      <tr>
        <th>Sample Response</th>
        <td>
          <pre><code>
            &lt;<xsl:value-of select="substring-after(@message, ':')"/> xmlns="<xsl:value-of select="../@targetNamespace"/>">
              <xsl:apply-templates select="document(concat(substring-after(@message, ':'), '.xsd'))/*"/>
            &lt;/<xsl:value-of select="substring-after(@message, ':')"/>>
          </code></pre>
        </td>
      </tr>
    </table>
  </xsl:template>

  <!-- Template for XSD elements -->
  <xsl:template match="xs:element">
    <xsl:variable name="ns" select="namespace-uri()"/>
    <xsl:variable name="localName" select="local-name()"/>
    <xsl:choose>
      <xsl:when test="$ns = 'http://www.w3.org/2001/XMLSchema'">
        <xsl:choose>
          <xsl:when test="@type">
            <xsl:value-of select="concat('&lt;', $localName, '>', '...', '&lt;/', $localName, '>')"/>
          </xsl:when>
          <xsl:otherwise>
            <xsl:value-of select="concat('&lt;', $localName, '>', '...', '&lt;/', $localName, '>')"/>
          </xsl:otherwise>
        </xsl:choose>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="concat('&lt;', $localName, '>', '...', '&lt;/', $localName, '>')"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:template>

</xsl:stylesheet>

